<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PeakSelf - Analytics Platform</title>
    
    <!-- Google Analytics 4 with Consent Mode v2 -->
    <script>
      // Initialize dataLayer before gtag script loads
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      
      // Check for existing consent from localStorage
      const hasConsent = localStorage.getItem('cookie-consent') === 'accepted';
      
      // Set default consent state before GA loads
      gtag('consent', 'default', {
        'analytics_storage': hasConsent ? 'granted' : 'denied',
        'ad_storage': 'denied',
        'ad_user_data': 'denied',
        'ad_personalization': 'denied',
        'wait_for_update': 500
      });
    </script>
    
    <!-- Google tag (gtag.js) - Loaded if GA measurement ID is configured -->
    <script>
      // Load gtag.js script if measurement ID is set
      const GA_MEASUREMENT_ID = '%VITE_GA_MEASUREMENT_ID%';
      console.log('üìä index.html GA_MEASUREMENT_ID:', GA_MEASUREMENT_ID);
      if (GA_MEASUREMENT_ID && GA_MEASUREMENT_ID !== '%VITE_GA_MEASUREMENT_ID%' && !GA_MEASUREMENT_ID.startsWith('%')) {
        console.log('‚úÖ Loading gtag.js script...');
        const script = document.createElement('script');
        script.async = true;
        script.src = 'https://www.googletagmanager.com/gtag/js?id=' + GA_MEASUREMENT_ID;
        script.onload = () => console.log('‚úÖ gtag.js loaded successfully');
        script.onerror = () => console.error('‚ùå Failed to load gtag.js');
        document.head.appendChild(script);
      } else {
        console.warn('‚ö†Ô∏è gtag.js script NOT loaded. GA_MEASUREMENT_ID:', GA_MEASUREMENT_ID);
      }
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
