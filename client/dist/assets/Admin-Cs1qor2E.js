import{j as e,a as S}from"./index-CSgcOYuY.js";import{r as n,g as Y,e as G,u as J,R as K,c as R,N as X}from"./vendor-NZU9o91k.js";import{j as q,k as Q,a as Z,I as ee,F as se,Y as te,l as ie,m as ne,E as re,B as ae,n as oe,o as le,p as de,q as ce,r as he,s as me,t as ue,u as xe,v as fe,X as pe,M as ge}from"./icons-BGCQDtub.js";function je(){const[c,f]=n.useState("general"),[m,u]=n.useState("neutral"),j=n.useMemo(()=>[{key:"neutral",name:"Neutral",tones:["#111","#333","#888","#e0e0e0","#fff"]},{key:"dim",name:"Dim",tones:["#111","#222","#555","#cfcfcf","#f6f6f6"]},{key:"contrast",name:"High Contrast",tones:["#000","#111","#666","#dddddd","#ffffff"]},{key:"mono",name:"Mono",tones:["#111","#444","#777","#bbbbbb","#f2f2f2"]}],[]),g=[{key:"general",label:"General"},{key:"appearance",label:"Appearance"},{key:"security",label:"Security"},{key:"email",label:"Email"}];return e.jsxs("div",{style:{display:"grid",gap:"1rem"},children:[e.jsxs("div",{className:"traffic-toolbar",children:[e.jsx("div",{className:"toolbar-top",children:e.jsx("div",{className:"title",children:"Settings"})}),e.jsx("div",{className:"traffic-chip-row",children:g.map(i=>e.jsx("button",{type:"button",className:`traffic-chip ${c===i.key?"active":""}`,onClick:()=>f(i.key),children:i.label},i.key))})]}),e.jsxs("div",{style:{background:"#fff",border:"1px solid #d0d0d0",borderRadius:12,padding:"1.5rem",boxShadow:"0 1px 3px rgba(0,0,0,0.08)"},children:[c==="general"&&e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("h2",{style:{fontSize:20,fontWeight:800,margin:0,marginBottom:4},children:"General Settings"}),e.jsx("p",{style:{fontSize:13,color:"#666",margin:0},children:"Basic configuration for your site"})]}),e.jsxs("div",{style:{display:"grid",gap:"1.25rem",maxWidth:600},children:[e.jsx(E,{label:"Site Title",children:e.jsx("input",{type:"text",placeholder:"PeakSelf",style:B})}),e.jsx(E,{label:"Support Email",children:e.jsx("input",{type:"email",placeholder:"support@example.com",style:B})}),e.jsx(E,{label:"Tagline",children:e.jsx("textarea",{rows:3,placeholder:"A short description of your site",style:B})}),e.jsx(E,{label:"Maintenance Mode",description:"Enable this to show a maintenance page to visitors",children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",style:{width:18,height:18}}),e.jsx("span",{style:{fontSize:13},children:"Enable maintenance mode"})]})})]})]}),c==="appearance"&&e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("h2",{style:{fontSize:20,fontWeight:800,margin:0,marginBottom:4},children:"Appearance"}),e.jsx("p",{style:{fontSize:13,color:"#666",margin:0},children:"Customize the look and feel"})]}),e.jsxs("div",{style:{display:"grid",gap:"1.5rem",maxWidth:600},children:[e.jsx(E,{label:"Theme",description:"Choose between light, dark, or auto mode",children:e.jsx("div",{style:{display:"flex",gap:12},children:["Light","Auto","Dark"].map(i=>e.jsxs("label",{style:{flex:1,padding:"12px",border:"2px solid #d0d0d0",borderRadius:8,cursor:"pointer",textAlign:"center",fontSize:13,fontWeight:600,transition:"all 0.2s ease",background:i==="Light"?"#111":"#fff",color:i==="Light"?"#fff":"#111"},children:[e.jsx("input",{type:"radio",name:"theme",defaultChecked:i==="Light",style:{display:"none"}}),i]},i))})}),e.jsx(E,{label:"Color Palette",description:"Select your preferred color scheme",children:e.jsx("div",{style:{display:"grid",gap:12},children:j.map(i=>e.jsxs("button",{type:"button",onClick:()=>u(i.key),style:{padding:"12px 16px",border:m===i.key?"2px solid #111":"1px solid #d0d0d0",borderRadius:8,background:"#fff",cursor:"pointer",textAlign:"left",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.2s ease"},children:[e.jsx("span",{style:{fontWeight:600,fontSize:14},children:i.name}),e.jsx("div",{style:{display:"flex",gap:4},children:i.tones.map((b,p)=>e.jsx("div",{style:{width:20,height:20,background:b,borderRadius:4,border:"1px solid #ddd"}},p))})]},i.key))})})]})]}),c==="security"&&e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("h2",{style:{fontSize:20,fontWeight:800,margin:0,marginBottom:4},children:"Security"}),e.jsx("p",{style:{fontSize:13,color:"#666",margin:0},children:"Authentication and session options"})]}),e.jsxs("div",{style:{display:"grid",gap:"1.25rem",maxWidth:600},children:[e.jsx(E,{label:"JWT Expiry",description:"Number of days before tokens expire",children:e.jsx("input",{type:"number",min:1,max:30,defaultValue:1,style:B})}),e.jsx(E,{label:"Two-Factor Authentication",children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",style:{width:18,height:18}}),e.jsx("span",{style:{fontSize:13},children:"Require 2FA for all users"})]})}),e.jsx(E,{label:"Email Login",children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",defaultChecked:!0,style:{width:18,height:18}}),e.jsx("span",{style:{fontSize:13},children:"Allow login with email and password"})]})})]})]}),c==="email"&&e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("h2",{style:{fontSize:20,fontWeight:800,margin:0,marginBottom:4},children:"Email Configuration"}),e.jsx("p",{style:{fontSize:13,color:"#666",margin:0},children:"Configure email settings and SMTP"})]}),e.jsxs("div",{style:{display:"grid",gap:"1.25rem",maxWidth:600},children:[e.jsx(E,{label:"From Name",children:e.jsx("input",{type:"text",placeholder:"PeakSelf",style:B})}),e.jsx(E,{label:"From Address",children:e.jsx("input",{type:"email",placeholder:"no-reply@example.com",style:B})}),e.jsx(E,{label:"SMTP Configuration",children:e.jsxs("div",{style:{padding:"12px 16px",background:"#f6f6f6",border:"1px solid #d0d0d0",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,marginBottom:2},children:"Status"}),e.jsx("div",{style:{fontSize:12,color:"#666"},children:"Not configured"})]}),e.jsx("button",{className:"btn small",type:"button",children:"Configure"})]})})]})]}),e.jsxs("div",{style:{marginTop:"2rem",paddingTop:"1.5rem",borderTop:"1px solid #e0e0e0",display:"flex",gap:12,justifyContent:"flex-end"},children:[e.jsx("button",{className:"btn secondary",type:"button",children:"Reset Changes"}),e.jsx("button",{className:"btn primary",type:"button",children:"Save Changes"})]})]})]})}const B={width:"100%",padding:"10px 12px",border:"1px solid #d0d0d0",borderRadius:8,fontSize:14,background:"#fff",fontFamily:"inherit",transition:"border-color 0.2s ease",outline:"none"};function E({label:c,description:f,children:m}){return e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:13,fontWeight:700,color:"#111",marginBottom:2},children:c}),f&&e.jsx("div",{style:{fontSize:12,color:"#888"},children:f})]}),e.jsx("div",{children:m})]})}const ve="http://localhost:5000";function ye(){const[c,f]=n.useState(!0),[m,u]=n.useState(""),[j,g]=n.useState(null);if(n.useEffect(()=>{let p=!1;async function w(){try{const d=await S(`${ve}/api/admin/overview`,{});if(d.status===401||d.status===403){window.location.href="/not-accessible";return}const v=await d.json();if(!d.ok)throw new Error(v.error||"Failed to load dashboard");p||g(v)}catch(d){p||u(d.message||"Failed to load dashboard")}finally{p||f(!1)}}return w(),()=>{p=!0}},[]),c)return e.jsx("div",{style:{padding:"1rem"},children:"Loading overview…"});if(m)return e.jsxs("div",{style:{padding:"1rem",color:"#b91c1c"},children:["Error: ",m]});const i=j||{},b=i.snapshot_at?new Date(i.snapshot_at).toLocaleString():i.source==="live"?"live":"";return e.jsxs("div",{className:"admin-content",children:[e.jsxs("div",{className:"traffic-toolbar",children:[e.jsx("div",{className:"toolbar-top",children:e.jsx("div",{className:"title",children:"Overview"})}),e.jsx("div",{className:"traffic-chip-row",children:e.jsxs("div",{style:{fontSize:12,color:"#666"},children:["Source: ",i.source||"snapshot"," ",b&&`• ${b}`]})})]}),e.jsxs("div",{className:"card-grid",children:[e.jsx(I,{icon:q,title:"Total Users",value:A(i.total_users),subtitle:i.signups_24h!=null?`+${A(i.signups_24h)} / 24h`:""}),e.jsx(I,{icon:Q,title:"Verified Users",value:A(i.verified_users),subtitle:""}),e.jsx(I,{icon:Z,title:"Newsletter Subs",value:A(i.newsletter_total),subtitle:i.newsletter_signups_24h!=null?`+${A(i.newsletter_signups_24h)} / 24h`:""}),e.jsx(I,{icon:ee,title:"Sessions • Instagram",value:A(i.sessions_instagram),subtitle:"last 7 days",color:"#E4405F"}),e.jsx(I,{icon:se,title:"Sessions • Facebook",value:A(i.sessions_facebook),subtitle:"last 7 days",color:"#1877F2"}),e.jsx(I,{icon:te,title:"Sessions • YouTube",value:A(i.sessions_youtube),subtitle:"last 7 days",color:"#FF0000"}),e.jsx(I,{icon:be,title:"Sessions • Google",value:A(i.sessions_google),subtitle:"last 7 days",color:"#4285F4"}),e.jsx(I,{icon:ie,title:"Sessions • Others",value:A(i.sessions_others),subtitle:"last 7 days",color:"#6366F1"})]}),Array.isArray(i.sessions_others_refs)&&i.sessions_others_refs.length>0&&e.jsxs("div",{style:{border:"1px solid #d0d0d0",borderRadius:12,padding:"1.5rem",background:"#fff",boxShadow:"0 1px 3px rgba(0,0,0,0.08)",marginTop:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid #e5e5e5"},children:[e.jsx(ne,{size:18,style:{color:"#000"}}),e.jsx("h3",{style:{fontSize:16,fontWeight:800,color:"#000",margin:0},children:'Top "Others" Referrers'}),e.jsx("span",{style:{fontSize:11,color:"#666",marginLeft:"auto",textTransform:"uppercase",fontWeight:700,letterSpacing:"0.5px"},children:"Last 7 Days"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:i.sessions_others_refs.map((p,w)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"0.75rem",background:"#fff",borderRadius:8,border:"1px solid #ddd",transition:"all 0.2s ease"},onMouseEnter:d=>{d.currentTarget.style.background="#f5f5f5",d.currentTarget.style.borderColor="#999";const v=d.currentTarget.querySelector(".rank-badge"),y=d.currentTarget.querySelector(".link-icon"),a=d.currentTarget.querySelector(".ref-text");v&&(v.style.background="#333"),y&&(y.style.color="#000"),a&&(a.style.color="#000")},onMouseLeave:d=>{d.currentTarget.style.background="#fff",d.currentTarget.style.borderColor="#ddd";const v=d.currentTarget.querySelector(".rank-badge"),y=d.currentTarget.querySelector(".link-icon"),a=d.currentTarget.querySelector(".ref-text");v&&(v.style.background="#000"),v&&(v.style.color="#fff"),y&&(y.style.color="#666"),a&&(a.style.color="#111")},children:[e.jsx("div",{className:"rank-badge",style:{minWidth:24,height:24,borderRadius:"50%",background:"#000",display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,fontWeight:900,color:"#fff",flexShrink:0,transition:"all 0.2s ease"},children:w+1}),e.jsx(re,{className:"link-icon",size:14,style:{color:"#666",flexShrink:0,transition:"all 0.2s ease"}}),e.jsx("span",{className:"ref-text",style:{fontSize:13,color:"#111",fontWeight:600,flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",transition:"all 0.2s ease"},children:String(p)})]},w))})]})]})}function I({icon:c,title:f,value:m,subtitle:u,color:j}){return e.jsxs("div",{style:{border:"1px solid #d0d0d0",borderRadius:12,padding:"1.25rem",background:"#fff",boxShadow:"0 1px 3px rgba(0,0,0,0.08)",transition:"transform 0.2s ease, box-shadow 0.2s ease",cursor:"default"},onMouseEnter:g=>{g.currentTarget.style.transform="translateY(-2px)",g.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.12)"},onMouseLeave:g=>{g.currentTarget.style.transform="translateY(0)",g.currentTarget.style.boxShadow="0 1px 3px rgba(0,0,0,0.08)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsx("div",{style:{fontSize:11,color:"#666",textTransform:"uppercase",fontWeight:700,letterSpacing:"0.5px"},children:f}),c&&e.jsx(c,{size:20,style:{color:j||"#666",opacity:.7}})]}),e.jsx("div",{style:{fontSize:28,fontWeight:900,color:"#111",lineHeight:1},children:m}),u&&e.jsx("div",{style:{fontSize:12,color:"#888",marginTop:8},children:u})]})}function be({size:c=20,style:f}){return e.jsxs("svg",{width:c,height:c,viewBox:"0 0 24 24",style:f,children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]})}function A(c){if(c==null)return"-";try{return Number(c).toLocaleString()}catch{return String(c)}}const U="http://localhost:5000";function ke(){const[c,f]=n.useState("all"),[m,u]=n.useState(""),[j,g]=n.useState(!0),[i,b]=n.useState(""),[p,w]=n.useState([]);async function d(){g(!0),b("");try{const s=new URLSearchParams;m&&s.set("q",m),c&&c!=="all"&&s.set("filter",c);const o=await S(`${U}/api/admin/users?${s.toString()}`,{}),t=await o.json();if(!o.ok)throw new Error(t.error||"Failed to load users");w(Array.isArray(t.users)?t.users:[])}catch(s){b(s.message||"Failed to load users")}finally{g(!1)}}n.useEffect(()=>{d()},[m,c]);const v=async()=>{const s=window.prompt("Enter email to invite:");if(s)try{const o=await S(`${U}/api/admin/users/invite`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s})}),t=await o.json();if(!o.ok)throw new Error(t.error||"Invite failed");alert(t.message||"Invitation sent"),d()}catch(o){alert(o.message||"Invite failed")}},y=()=>{window.open(`${U}/api/admin/users.csv`,"_blank")},a=async s=>{try{const o=await S(`${U}/api/admin/users/${encodeURIComponent(s)}/make-admin`,{method:"POST"}),t=await o.json();if(!o.ok)throw new Error(t.error||"Failed to promote user");d()}catch(o){alert(o.message||"Failed to promote user")}},T=async s=>{try{const o=await S(`${U}/api/admin/users/${encodeURIComponent(s)}/remove-admin`,{method:"POST"}),t=await o.json();if(!o.ok)throw new Error(t.error||"Failed to remove admin role");d()}catch(o){alert(o.message||"Failed to remove admin role")}},h=async s=>{if(window.confirm("Are you sure you want to remove this user?"))try{const o=await S(`${U}/api/admin/users/${encodeURIComponent(s)}`,{method:"DELETE"}),t=await o.json();if(!o.ok)throw new Error(t.error||"Failed to remove user");d()}catch(o){alert(o.message||"Failed to remove user")}};return n.useEffect(()=>{const s=o=>{if((o.ctrlKey||o.metaKey)&&String(o.key).toLowerCase()==="k"){o.preventDefault();const F=document.getElementById("users-search-input");F&&F.focus()}o.key==="Escape"&&u("")};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[]),e.jsxs("div",{className:"admin-users",children:[e.jsxs("div",{className:"traffic-toolbar",children:[e.jsx("div",{className:"toolbar-top",children:e.jsx("div",{className:"title",children:"Users"})}),e.jsx("form",{className:"traffic-search-form",onSubmit:s=>{s.preventDefault(),d()},children:e.jsxs("div",{className:"traffic-search",role:"search",children:[e.jsx("span",{className:"search-icon","aria-hidden":!0,children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})}),e.jsx("input",{id:"users-search-input",type:"search",className:"traffic-search-input",placeholder:"Search users by name or email...",value:m,onChange:s=>u(s.target.value),"aria-label":"Search users"}),m&&e.jsx("button",{type:"button",className:"traffic-search-clear","aria-label":"Clear search",title:"Clear",onClick:()=>{u(""),setTimeout(d,0)},children:"×"}),e.jsx("button",{type:"submit",className:"btn primary search-btn",children:"Search"})]})}),e.jsxs("div",{className:"traffic-chip-row",children:[[{key:"all",label:"All"},{key:"admins",label:"Admins"},{key:"unverified",label:"Unverified"}].map(s=>e.jsx("button",{type:"button",onClick:()=>f(s.key),className:`traffic-chip ${c===s.key?"active":""}`,"aria-pressed":c===s.key,children:s.label},s.key)),e.jsx("button",{type:"button",className:"traffic-chip",onClick:v,children:"Invite User"}),e.jsx("button",{type:"button",className:"traffic-chip",onClick:y,children:"Export CSV"})]})]}),j&&e.jsx("div",{style:{padding:"0.75rem"},children:"Loading users..."}),i&&!j&&e.jsxs("div",{style:{padding:"0.75rem",color:"#b91c1c"},children:["Error: ",i]}),!j&&!i&&e.jsx("div",{className:"table-wrap",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsx("tr",{children:["Name","Email","Role","Verified","Actions"].map(s=>e.jsx("th",{children:s},s))})}),e.jsxs("tbody",{children:[p.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.name||"—"}),e.jsx("td",{children:s.email}),e.jsx("td",{children:e.jsx("span",{className:`role ${s.role}`,children:s.role})}),e.jsx("td",{children:s.verified?"Yes":"No"}),e.jsx("td",{children:e.jsxs("div",{className:"row-actions",children:[e.jsx("button",{className:"btn small",onClick:()=>alert(JSON.stringify(s,null,2)),children:"View"}),s.role!=="admin"?e.jsx("button",{className:"btn small",onClick:()=>a(s.id),children:"Make Admin"}):e.jsx("button",{className:"btn small",onClick:()=>T(s.id),children:"Remove Admin"}),e.jsx("button",{className:"btn small danger",onClick:()=>h(s.id),children:"Remove"})]})})]},s.id)),p.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{padding:"1rem",color:"#666"},children:"No users found."})})]})]})})]})}function we({onSave:c,onCancel:f,initialPost:m}){const[u,j]=n.useState(m?.title||""),[g,i]=n.useState([]),[b,p]=n.useState(!1),[w,d]=n.useState(""),[v,y]=n.useState(""),a=n.useRef(null),T=n.useRef(null),h=n.useRef(null);Y.useEffect(()=>{m?.content&&a.current&&(a.current.innerHTML=m.content)},[m]);const s=x=>{document.execCommand(x,!1,null),a.current.focus()},o=()=>{const x=window.getSelection(),k=x.toString();x.rangeCount>0&&(h.current=x.getRangeAt(0).cloneRange()),k&&d(k),p(!0)},t=()=>{p(!1),v&&setTimeout(()=>{if(a.current.focus(),h.current){const k=window.getSelection();k.removeAllRanges(),k.addRange(h.current)}const x=`<a href="${v}" target="_blank" rel="noopener noreferrer">${w||v}</a>`;document.execCommand("insertHTML",!1,x),h.current=null},0),d(""),y("")},F=async x=>{const k=x.target.files[0];if(console.log("File selected:",k),!k){console.log("No file selected");return}if(!k.type.startsWith("image/")){alert("Please select an image file");return}const N=new FileReader;N.onerror=C=>{console.error("FileReader error:",C),alert("Failed to read image file")},N.onload=async C=>{console.log("File loaded, inserting temp image"),a.current.focus();const L=`<div class="image-wrapper uploading" contenteditable="false" data-temp="true"><img src="${C.target.result}" class="blog-image" alt="Uploading..." /></div>`;document.execCommand("insertHTML",!1,L),console.log("Temp image inserted, starting upload");try{const r=new FormData;r.append("image",k),console.log("Uploading to server...");const _=await S("http://localhost:5000/api/admin/blog/upload-image",{method:"POST",body:r});if(console.log("Upload response status:",_.status),!_.ok){const O=await _.json().catch(()=>({error:"Unknown error"}));throw console.error("Upload failed:",O),new Error(O.error||"Failed to upload image")}const{url:z}=await _.json();console.log("Upload successful, image URL:",z);const W=a.current.querySelector('.image-wrapper[data-temp="true"]');if(W){const O=`<div class="image-wrapper" contenteditable="false"><img src="${z}" class="blog-image" alt="Blog image" /></div><p><br></p>`;W.outerHTML=O,console.log("Image inserted successfully")}else console.warn("Could not find temp image wrapper")}catch(r){console.error("Error uploading image:",r);const l=a.current.querySelector('.image-wrapper[data-temp="true"]');l&&l.remove(),alert(`Failed to upload image: ${r.message}`)}setTimeout(()=>{a.current.querySelectorAll(".image-wrapper").forEach(l=>{l.hasAttribute("data-listener")||(l.setAttribute("data-listener","true"),l.addEventListener("click",function(){this.classList.toggle("selected")}))})},0)},N.readAsDataURL(k),x.target.value=""},M=x=>{if(x.key==="Backspace"||x.key==="Delete"){const k=window.getSelection();if(k.rangeCount>0){const N=k.getRangeAt(0),C=N.startContainer;let L=null;if(x.key==="Backspace"){const l=(C.nodeType===3||N.startOffset===0)&&C.previousSibling;l&&l.classList&&l.classList.contains("image-wrapper")&&(L=l)}else if(x.key==="Delete"){const l=C.nodeType===3?C.nextSibling:C.childNodes[N.startOffset];l&&l.classList&&l.classList.contains("image-wrapper")&&(L=l)}const r=a.current.querySelector(".image-wrapper.selected");if(r&&(L=r),L){x.preventDefault(),L.remove();return}}}},P=()=>{const x=a.current.innerHTML;c({title:u,content:x,excerpt:a.current.innerText.substring(0,150)})};return e.jsx("div",{className:"content-editor-overlay",children:e.jsxs("div",{className:"content-editor-modal",children:[e.jsx("div",{className:"editor-header",children:e.jsx("input",{type:"text",placeholder:"Post Title",value:u,onChange:x=>j(x.target.value),className:"title-input"})}),e.jsxs("div",{className:"editor-toolbar",children:[e.jsx("button",{type:"button",onClick:()=>s("bold"),className:"toolbar-btn",title:"Bold",children:e.jsx(ae,{size:18})}),e.jsx("button",{type:"button",onClick:()=>s("italic"),className:"toolbar-btn",title:"Italic",children:e.jsx(oe,{size:18})}),e.jsx("button",{type:"button",onClick:()=>s("underline"),className:"toolbar-btn",title:"Underline",children:e.jsx(le,{size:18})}),e.jsx("div",{className:"toolbar-divider"}),e.jsx("button",{type:"button",onClick:o,className:"toolbar-btn",title:"Insert Link",children:e.jsx(de,{size:18})}),e.jsx("button",{type:"button",onClick:()=>T.current.click(),className:"toolbar-btn",title:"Insert Image",children:e.jsx(ce,{size:18})}),e.jsx("input",{ref:T,type:"file",accept:"image/*",onChange:F,style:{display:"none"}})]}),e.jsx("div",{ref:a,contentEditable:!0,className:"editor-content",onKeyDown:M,suppressContentEditableWarning:!0}),e.jsxs("div",{className:"editor-actions",children:[e.jsx("button",{onClick:f,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:P,className:"btn-primary",children:"Save Post"})]}),b&&e.jsx("div",{className:"link-modal-overlay",onClick:()=>p(!1),children:e.jsxs("div",{className:"link-modal",onClick:x=>x.stopPropagation(),children:[e.jsx("h3",{children:"Insert Link"}),e.jsx("input",{type:"text",placeholder:"Link text",value:w,onChange:x=>d(x.target.value),className:"link-input"}),e.jsx("input",{type:"url",placeholder:"URL (https://...)",value:v,onChange:x=>y(x.target.value),className:"link-input"}),e.jsxs("div",{className:"link-modal-actions",children:[e.jsx("button",{onClick:()=>p(!1),className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:t,className:"btn-primary",children:"Insert"})]})]})})]})})}const H="http://localhost:5000";function Se(){const[c,f]=n.useState(!1),[m,u]=n.useState([]),[j,g]=n.useState(null),[i,b]=n.useState(!0),[p,w]=n.useState("");n.useEffect(()=>{d()},[]);const d=async()=>{try{b(!0);const h=await S(`${H}/api/admin/blog`,{}),s=await h.json();if(!h.ok)throw new Error(s.error||"Failed to fetch posts");u(s.posts)}catch(h){w(h.message)}finally{b(!1)}},v=async h=>{try{if(j){const s=await S(`${H}/api/admin/blog/${j.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}),o=await s.json();if(!s.ok)throw new Error(o.error||"Failed to update post");u(m.map(t=>t.id===j.id?o.post:t)),g(null)}else{const s=await S(`${H}/api/admin/blog`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}),o=await s.json();if(!s.ok)throw new Error(o.error||"Failed to create post");u([o.post,...m])}f(!1)}catch(s){alert(s.message)}},y=h=>{g(h),f(!0)},a=()=>{f(!1),g(null)},T=async h=>{if(confirm("Are you sure you want to delete this post?"))try{const s=await S(`${H}/api/admin/blog/${h}`,{method:"DELETE"});if(!s.ok){const o=await s.json();throw new Error(o.error||"Failed to delete post")}u(m.filter(o=>o.id!==h))}catch(s){alert(s.message)}};return i?e.jsx("div",{style:{padding:"2rem"},children:"Loading posts..."}):p?e.jsxs("div",{style:{padding:"2rem",color:"#b91c1c"},children:["Error: ",p]}):e.jsxs("div",{className:"admin-content",children:[e.jsxs("div",{className:"traffic-toolbar",children:[e.jsxs("div",{className:"toolbar-top",children:[e.jsx("div",{className:"title",children:"Content"}),e.jsx("button",{className:"add-content-btn",onClick:()=>f(!0),title:"Add Content",children:e.jsx(he,{size:20})})]}),e.jsxs("div",{className:"traffic-chip-row",children:[e.jsx("button",{className:"traffic-chip",type:"button",children:"All Posts"}),e.jsx("button",{className:"traffic-chip",type:"button",children:"Drafts"}),e.jsx("button",{className:"traffic-chip",type:"button",children:"Categories"})]})]}),e.jsx("div",{className:"card-grid",children:m.map(h=>e.jsxs("div",{className:"content-card",children:[e.jsx("div",{className:"content-title",children:h.title}),e.jsx("div",{className:"content-excerpt",children:h.excerpt}),e.jsxs("div",{className:"row-actions",children:[e.jsx("button",{className:"btn small",onClick:()=>y(h),children:"Edit"}),e.jsx("button",{className:"btn small",children:"Publish"}),e.jsx("button",{className:"btn small danger",onClick:()=>T(h.id),children:"Delete"})]})]},h.id))}),c&&e.jsx(we,{onSave:v,onCancel:a,initialPost:j})]})}const V="http://localhost:5000";function $(c){const f=new Date(c),u=new Date-f,j=Math.floor(u/(1e3*60)),g=Math.floor(u/(1e3*60*60)),i=Math.floor(u/(1e3*60*60*24));return j<1?"Just now":j<60?`${j}m ago`:g<24?`${g}h ago`:i<7?`${i}d ago`:f.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}const D={instagram:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24","aria-hidden":!0,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"ig-small-sessions",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#f58529"}),e.jsx("stop",{offset:"50%",stopColor:"#dd2a7b"}),e.jsx("stop",{offset:"100%",stopColor:"#8134af"})]})}),e.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"5",fill:"url(#ig-small-sessions)"}),e.jsx("circle",{cx:"12",cy:"12",r:"4.5",fill:"none",stroke:"#fff",strokeWidth:"2"}),e.jsx("circle",{cx:"17",cy:"7",r:"1.3",fill:"#fff"})]}),facebook:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24","aria-hidden":!0,children:[e.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",fill:"#1877f2"}),e.jsx("path",{d:"M16 8h-2c-.5 0-1 .5-1 1v2h3l-.5 3h-2.5v7h-3v-7H8v-3h2V9c0-2 1.5-4 4-4h2v3z",fill:"#fff"})]}),youtube:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24","aria-hidden":!0,children:[e.jsx("rect",{x:"2",y:"6",width:"20",height:"12",rx:"3",fill:"#ff0000"}),e.jsx("polygon",{points:"10,9 16,12 10,15",fill:"#ffffff"})]}),google:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24","aria-hidden":!0,children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),other:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24","aria-hidden":!0,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",fill:"#666"}),e.jsx("path",{d:"M2 12h20M12 2v20",stroke:"#fff",strokeWidth:"1.5",opacity:"0.6"}),e.jsx("circle",{cx:"12",cy:"12",r:"5",fill:"none",stroke:"#fff",strokeWidth:"1.5",opacity:"0.9"})]})};function Ne(){const[c,f]=n.useState(!0),[m,u]=n.useState(""),[j,g]=n.useState([]),[i,b]=n.useState(0),[p,w]=n.useState(""),[d,v]=n.useState(""),[y,a]=n.useState(""),[T,h]=n.useState(!0),[s,o]=n.useState(null),[t,F]=n.useState(null),[M,P]=n.useState([]),[x,k]=n.useState(!1);async function N(r=0){try{f(!0);const l=new URLSearchParams;p&&l.set("source",p),d&&l.set("user_id",d),y&&l.set("visitor_id",y),l.set("limit","50"),l.set("offset",String(r*50));const _=await S(`${V}/api/admin/sessions?${l.toString()}`,{}),z=await _.json();if(!_.ok)throw new Error(z.error||"Failed to load sessions");g(Array.isArray(z.sessions)?z.sessions:[]),b(r),u("")}catch(l){u(l.message||"Failed to load sessions"),g([])}finally{f(!1)}}async function C(r){try{o(r),k(!0),F(null),P([]);const[l,_]=await Promise.all([S(`${V}/api/admin/sessions/${r}`,{}),S(`${V}/api/admin/sessions/${r}/events`,{})]),z=await l.json(),W=await _.json();if(!l.ok)throw new Error(z.error||"Failed to load session");if(!_.ok)throw new Error(W.error||"Failed to load events");F(z.session||null),P(Array.isArray(W.events)?W.events:[])}catch(l){u(l.message||"Failed to load session")}}if(n.useEffect(()=>{N(0)},[]),n.useEffect(()=>{N(0)},[p]),c)return e.jsx("div",{style:{padding:16},children:"Loading sessions…"});if(m)return e.jsxs("div",{style:{padding:16,color:"#b91c1c"},children:["Error: ",m]});const L=r=>r.ended_at||Date.now()-new Date(r.last_seen_at).getTime()>1800*1e3;return e.jsxs("div",{className:"admin-traffic",children:[e.jsx("div",{className:"traffic-toolbar",children:e.jsx("div",{className:"toolbar-top",children:e.jsx("div",{className:"title",children:"Sessions"})})}),e.jsxs("div",{className:"traffic-table-wrap",style:{display:"grid",gridTemplateColumns:T?"1fr 300px":"1fr",gap:12,alignItems:"start",marginTop:16},children:[e.jsx("div",{className:"table-card",style:{background:"transparent",border:"none"},children:e.jsxs("div",{style:{padding:16},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:16},children:j.map(r=>e.jsxs("button",{onClick:()=>C(r.session_id),style:{position:"relative",textAlign:"left",background:"#ffffff",borderRadius:14,padding:0,display:"flex",flexDirection:"column",cursor:"pointer",overflow:"hidden",transition:"all 0.2s ease",borderColor:"#e1e5e9"},onMouseEnter:l=>{l.currentTarget.style.transform="translateY(-2px)",l.currentTarget.style.borderColor="#000000"},onMouseLeave:l=>{l.currentTarget.style.transform="translateY(0)",l.currentTarget.style.borderColor="#e1e5e9"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:0,bottom:0,width:4,background:"#000000"}}),e.jsxs("div",{style:{padding:"14px 16px 14px 20px",display:"flex",alignItems:"center",gap:14},children:[e.jsxs("div",{style:{width:52,height:52,minWidth:52,borderRadius:12,display:"flex",alignItems:"center",justifyContent:"center",background:"#f8f9fa",border:"2px solid #e5e7eb",position:"relative"},children:[D[r.visitor_source||"other"]||D.other,e.jsx("div",{style:{position:"absolute",bottom:-6,left:"50%",transform:"translateX(-50%)",background:"#111",color:"#fff",fontSize:9,fontWeight:300,padding:"2px 6px",borderRadius:4,whiteSpace:"nowrap",border:"1.5px solid #fff"},children:r.visitor_source||"other"})]}),e.jsxs("div",{style:{flex:1,display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:"#666",fontWeight:300,marginBottom:3},children:"Started"}),e.jsx("div",{style:{fontSize:14,fontWeight:600,color:"#111"},children:$(r.started_at)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:"#666",fontWeight:300,marginBottom:3},children:"Last Seen"}),e.jsx("div",{style:{fontSize:14,fontWeight:600,color:"#111"},children:$(r.last_seen_at)})]}),e.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",alignItems:"center",gap:6,marginTop:4},children:[e.jsxs("div",{style:{background:"#f3f4f6",padding:"4px 10px",borderRadius:6,display:"inline-flex",alignItems:"center",gap:4},children:[e.jsx("span",{style:{fontSize:11,color:"#666",fontWeight:300},children:"Source"}),e.jsx("span",{style:{fontSize:12,fontWeight:300,color:"#111"},children:r.source||"other"})]}),e.jsxs("div",{style:{background:"#f3f4f6",padding:"4px 10px",borderRadius:6,display:"inline-flex",alignItems:"center",gap:4},children:[e.jsx("span",{style:{fontSize:11,color:"#666",fontWeight:300},children:"Pages"}),e.jsx("span",{style:{fontSize:12,fontWeight:300,color:"#111"},children:r.page_count})]})]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center"},children:e.jsx("span",{style:{fontSize:11,fontWeight:600,padding:"6px 12px",borderRadius:6,border:"2px solid",borderColor:L(r)?"#e5e7eb":"#86efac",color:L(r)?"#6b7280":"#166534",background:L(r)?"#f9fafb":"#dcfce7",minWidth:70,textAlign:"center"},children:L(r)?"Ended":"Active"})})]})]},r.session_id))}),e.jsxs("div",{className:"pagination-controls",style:{marginTop:12},children:[e.jsx("button",{className:"btn pagination-btn",onClick:()=>{i>0&&N(i-1)},disabled:i===0,style:{opacity:i===0?.5:1},children:"Previous"}),e.jsx("button",{className:"btn pagination-btn",onClick:()=>N(i+1),children:"Next"})]})]})}),T&&e.jsxs("aside",{className:"filters-card",children:[e.jsx("div",{className:"filters-header",children:"Filters"}),e.jsxs("div",{className:"filters-body",children:[e.jsxs("label",{className:"field",children:[e.jsx("div",{className:"label",children:"Source"}),e.jsxs("select",{value:p,onChange:r=>w(r.target.value),children:[e.jsx("option",{value:"",children:"All sources"}),e.jsx("option",{value:"instagram",children:"Instagram"}),e.jsx("option",{value:"facebook",children:"Facebook"}),e.jsx("option",{value:"youtube",children:"YouTube"}),e.jsx("option",{value:"google",children:"Google"}),e.jsx("option",{value:"other",children:"Others"})]})]}),e.jsxs("label",{className:"field",children:[e.jsx("div",{className:"label",children:"User ID"}),e.jsx("input",{value:d,onChange:r=>v(r.target.value),placeholder:"UUID"})]}),e.jsxs("label",{className:"field",children:[e.jsx("div",{className:"label",children:"Visitor ID"}),e.jsx("input",{value:y,onChange:r=>a(r.target.value),placeholder:"UUID"})]}),e.jsxs("div",{className:"filter-buttons",children:[e.jsx("button",{className:"btn primary",onClick:()=>N(0),children:"Apply"}),e.jsx("button",{className:"btn",onClick:()=>{w(""),v(""),a(""),N(0)},children:"Reset"})]})]})]})]}),x&&s&&e.jsx("div",{className:"modal-overlay",onClick:()=>k(!1),children:e.jsxs("div",{className:"modal-content session-details-modal",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("div",{style:{width:42,height:42,borderRadius:10,background:"linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(9, 105, 218, 0.25)"},children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M12 1v6m0 6v6M5.6 5.6l4.2 4.2m4.2 4.2l4.2 4.2M1 12h6m6 0h6M5.6 18.4l4.2-4.2m4.2-4.2l4.2-4.2"})]})}),e.jsxs("div",{children:[e.jsx("h2",{className:"modal-title",style:{marginBottom:2},children:"Session Details"}),e.jsx("div",{style:{fontSize:12,color:"var(--text-muted)",fontWeight:500},children:"Complete session analytics & tracking data"})]})]}),e.jsx("button",{className:"modal-close",onClick:()=>k(!1),children:"×"})]}),e.jsx("div",{className:"modal-body",children:t?e.jsxs("div",{className:"session-details-content",children:[e.jsxs("div",{className:"session-status-banner",children:[e.jsxs("div",{className:"status-sources",children:[e.jsxs("div",{className:"source-item",children:[e.jsx("div",{className:"source-icon",children:D[t.visitor_source||"other"]||D.other}),e.jsxs("div",{className:"source-info",children:[e.jsx("div",{className:"source-label",children:"Visitor Source"}),e.jsx("div",{className:"source-value",children:t.visitor_source||"other"})]})]}),e.jsx("div",{className:"source-arrow",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M5 12h14M12 5l7 7-7 7"})})}),e.jsxs("div",{className:"source-item",children:[e.jsx("div",{className:"source-icon",children:D[t.source||"other"]||D.other}),e.jsxs("div",{className:"source-info",children:[e.jsx("div",{className:"source-label",children:"Session Source"}),e.jsx("div",{className:"source-value",children:t.source||"other"})]})]})]}),e.jsx("div",{className:"status-badge-container",children:e.jsxs("span",{className:`status-badge ${t.ended_at||Date.now()-new Date(t.last_seen_at).getTime()>1800*1e3?"ended":"active"}`,children:[e.jsx("span",{className:"status-dot"}),t.ended_at||Date.now()-new Date(t.last_seen_at).getTime()>1800*1e3?"Ended":"Active"]})})]}),e.jsxs("div",{className:"session-metrics-grid",children:[e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{background:"linear-gradient(135deg, #10b981 0%, #059669 100%)"},children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("polyline",{points:"12 6 12 12 16 14"})]})}),e.jsxs("div",{className:"metric-info",children:[e.jsx("div",{className:"metric-label",children:"Started"}),e.jsx("div",{className:"metric-value",children:$(t.started_at)}),e.jsx("div",{className:"metric-subtitle",children:new Date(t.started_at).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{background:"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)"},children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})})}),e.jsxs("div",{className:"metric-info",children:[e.jsx("div",{className:"metric-label",children:"Last Seen"}),e.jsx("div",{className:"metric-value",children:$(t.last_seen_at)}),e.jsx("div",{className:"metric-subtitle",children:new Date(t.last_seen_at).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{background:"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)"},children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"12",y1:"18",x2:"12",y2:"12"}),e.jsx("line",{x1:"9",y1:"15",x2:"15",y2:"15"})]})}),e.jsxs("div",{className:"metric-info",children:[e.jsx("div",{className:"metric-label",children:"Pages Viewed"}),e.jsx("div",{className:"metric-value",children:t.page_count}),e.jsx("div",{className:"metric-subtitle",children:t.page_count===1?"Single page":"Multiple pages"})]})]})]}),e.jsxs("div",{className:"info-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),"Session Information"]}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("div",{className:"info-label",children:"Session ID"}),e.jsx("div",{className:"info-value info-code",children:t.id})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("div",{className:"info-label",children:"Visitor ID"}),e.jsx("div",{className:"info-value info-code",children:t.visitor_id})]}),e.jsxs("div",{className:"info-item full-width",children:[e.jsx("div",{className:"info-label",children:"User"}),e.jsx("div",{className:"info-value",children:t.user_id?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx("img",{src:t.user_avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(t.user_name||t.user_email||"User")}&background=0969da&color=fff&size=40`,alt:t.user_name||t.user_email,style:{width:40,height:40,borderRadius:"50%",objectFit:"cover",border:"2px solid #e5e7eb"}}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:14,fontWeight:600,color:"#111",marginBottom:2},children:t.user_name||t.user_email}),t.user_name&&t.user_email&&e.jsx("div",{style:{fontSize:12,color:"#666"},children:t.user_email})]})]}):e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:"#f3f4f6",border:"2px solid #e5e7eb",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#9ca3af",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]})}),e.jsx("span",{style:{color:"var(--text-muted)",fontStyle:"italic",fontSize:14},children:"Guest User"})]})})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("div",{className:"info-label",children:"Landing Path"}),e.jsx("div",{className:"info-value info-path",children:t.landing_path||"/"})]}),t.referrer!==void 0&&e.jsxs("div",{className:"info-item full-width",children:[e.jsx("div",{className:"info-label",children:"Referrer"}),e.jsx("div",{className:"info-value info-url",children:t.referrer||e.jsx("span",{style:{color:"var(--text-muted)",fontStyle:"italic"},children:"Direct traffic"})})]})]})]}),e.jsxs("div",{className:"info-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),e.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),e.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),"Technical Details"]}),e.jsxs("div",{className:"info-grid",children:[t.ip&&e.jsxs("div",{className:"info-item",children:[e.jsx("div",{className:"info-label",children:"IP Address"}),e.jsx("div",{className:"info-value info-code",children:t.ip})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("div",{className:"info-label",children:"Session Ended"}),e.jsx("div",{className:"info-value",children:t.ended_at||Date.now()-new Date(t.last_seen_at).getTime()>1800*1e3?t.ended_at?new Date(t.ended_at).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Ended (inferred)":e.jsx("span",{style:{color:"#10b981",fontWeight:600},children:"Active Session"})})]}),t.user_agent&&e.jsxs("div",{className:"info-item full-width",children:[e.jsx("div",{className:"info-label",children:"User Agent"}),e.jsx("div",{className:"info-value info-small",children:t.user_agent})]})]})]}),e.jsxs("div",{className:"info-section events-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"22 12 18 12 15 21 9 3 6 12 2 12"})}),"Session Events Timeline",e.jsxs("span",{className:"event-count",children:[M.length," ",M.length===1?"event":"events"]})]}),M.length>0?e.jsx("div",{className:"events-timeline",children:M.map((r,l)=>e.jsxs("div",{className:"event-item",children:[e.jsxs("div",{className:"event-marker",children:[e.jsx("div",{className:"event-dot"}),l!==M.length-1&&e.jsx("div",{className:"event-line"})]}),e.jsxs("div",{className:"event-content",children:[e.jsxs("div",{className:"event-header",children:[e.jsx("div",{className:"event-time",children:$(r.occurred_at)}),e.jsx("div",{className:"event-time-full",children:new Date(r.occurred_at).toLocaleString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]}),e.jsxs("div",{className:"event-path",children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"})]}),r.path||"/"]}),r.referrer&&e.jsxs("div",{className:"event-referrer",children:[e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),e.jsx("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})]}),"from ",r.referrer]})]})]},l))}):e.jsxs("div",{className:"empty-state",children:[e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),e.jsx("div",{className:"empty-title",children:"No Events Recorded"}),e.jsx("div",{className:"empty-description",children:"This session doesn't have any tracked events yet."})]})]})]}):e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("div",{style:{marginTop:12,fontSize:14,color:"var(--text-muted)"},children:"Loading session details..."})]})})]})})]})}const Ce="http://localhost:5000";function _e(){const[c,f]=n.useState(!0),[m,u]=n.useState(""),[j,g]=n.useState(null),[i,b]=n.useState(!1),p=G(),w=J();n.useEffect(()=>{let a=!1;async function T(){try{const h=await S(`${Ce}/api/admin`,{});if(h.status===401||h.status===403){window.location.href="/not-accessible";return}const s=await h.json();if(!h.ok)throw new Error(s.error||"Failed to authenticate");a||g(s.user)}catch(h){a||u(h.message||"Failed to authenticate")}finally{a||f(!1)}}return T(),()=>{a=!0}},[]);const d=n.useMemo(()=>[{key:"overview",label:"Overview",icon:me,path:"/admin/overview"},{key:"sessions",label:"Sessions",icon:ue,path:"/admin/sessions"},{key:"users",label:"Users",icon:q,path:"/admin/users"},{key:"content",label:"Content",icon:xe,path:"/admin/content"},{key:"settings",label:"Settings",icon:fe,path:"/admin/settings"}],[]);if(c)return e.jsx("div",{style:{padding:"2rem"},children:"Loading admin..."});if(m)return e.jsxs("div",{style:{padding:"2rem",color:"#b91c1c"},children:["Error: ",m]});const v=w.pathname,y=d.find(a=>a.path===v)?.key||"overview";return e.jsxs("div",{style:{display:"flex",minHeight:"calc(100vh - 64px)",background:"#ebebeb",position:"relative"},children:[e.jsx("button",{onClick:()=>b(!i),style:{position:"fixed",top:80,left:16,zIndex:1e3,background:"#000",border:"1px solid #333",borderRadius:8,padding:"0.5rem",cursor:"pointer",display:"none",color:"#fff"},className:"mobile-menu-btn",children:i?e.jsx(pe,{size:20}):e.jsx(ge,{size:20})}),i&&e.jsx("div",{onClick:()=>b(!1),style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:998,display:"none"},className:"sidebar-overlay"}),e.jsxs("aside",{style:{width:260,borderRight:"1px solid #111",background:"#000",position:"fixed",height:"calc(100vh - 64px)",paddingTop:60,zIndex:999,transition:"transform 0.3s ease"},className:`admin-sidebar ${i?"sidebar-open":""}`,children:[e.jsxs("div",{style:{padding:"1rem 1rem 0.5rem 1rem"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:800,color:"#fff"},children:"Admin"}),e.jsx("div",{style:{fontSize:12,color:"#bbb"},children:"Signed in as"}),e.jsx("div",{style:{fontSize:13,color:"#ddd",wordBreak:"break-all"},children:j?.email})]}),e.jsx("div",{style:{padding:"0.75rem 0.5rem"},children:d.map(a=>e.jsxs("button",{onClick:()=>{p(a.path),b(!1)},style:{width:"100%",display:"flex",alignItems:"center",gap:10,padding:"0.6rem 0.75rem",background:y===a.key?"#fff":"transparent",color:y===a.key?"#111":"#ddd",border:"1px solid "+(y===a.key?"#fff":"#333"),borderRadius:8,margin:"0.25rem 0",cursor:"pointer",textAlign:"left"},children:[e.jsx(a.icon,{size:16,style:{color:y===a.key?"#111":"#ddd"}}),e.jsx("span",{style:{fontWeight:700,fontSize:14},children:a.label})]},a.key))})]}),e.jsx("section",{style:{flex:1,padding:"1.25rem",marginLeft:260},className:"admin-main-content",children:e.jsxs(K,{children:[e.jsx(R,{index:!0,element:e.jsx(X,{to:"/admin/overview",replace:!0})}),e.jsx(R,{path:"overview",element:e.jsx(ye,{})}),e.jsx(R,{path:"sessions",element:e.jsx(Ne,{})}),e.jsx(R,{path:"users",element:e.jsx(ke,{})}),e.jsx(R,{path:"content",element:e.jsx(Se,{})}),e.jsx(R,{path:"settings",element:e.jsx(je,{})})]})}),e.jsx("style",{children:`
        @media (max-width: 768px) {
          .mobile-menu-btn {
            display: block !important;
          }
          .sidebar-overlay {
            display: block !important;
          }
          .admin-sidebar {
            transform: translateX(-100%);
          }
          .admin-sidebar.sidebar-open {
            transform: translateX(0);
          }
          .admin-main-content {
            margin-left: 0 !important;
          }
        }
        @media (min-width: 769px) {
          .admin-sidebar {
            position: fixed !important;
            transform: translateX(0) !important;
          }
        }
      `})]})}export{_e as default};
